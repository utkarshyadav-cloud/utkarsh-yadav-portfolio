<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js"></script>
    <style>
        body { background: #2c3e50; color: white; text-align: center; font-family: sans-serif; }
        canvas { background: #000; border: 5px solid #ecf0f1; margin-top: 20px; }
        .stats { font-size: 24px; margin: 10px; }
        #restartBtn { 
            padding: 10px 20px; font-size: 16px; background: #3498db; 
            color: white; border: none; border-radius: 5px; cursor: pointer;
            display: none; /* Hidden until Game Over */
            margin: 10px auto;
        }
        #restartBtn:hover { background: #2980b9; }
    </style>
</head>
<body onload="brython()">

    <h1>Python Snake Game</h1>
    <div class="stats">Score: <span id="score">0</span></div>
    
    <button id="restartBtn">Play Again</button>
    <br>
    
    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <script type="text/python">
        from browser import document, window, timer
        import random

        SIZE = 20
        WIDTH = 400
        canvas = document["gameCanvas"]
        ctx = canvas.getContext("2d")
        
        # Global variables for game state
        snake = []
        direction = {}
        food = {}
        score = 0
        game_running = False

        def init_game(ev=None):
            """This function sets (or resets) all variables to start state"""
            global snake, direction, food, score, game_running
            
            snake = [{"x": 100, "y": 100}, {"x": 80, "y": 100}, {"x": 60, "y": 100}]
            direction = {"x": SIZE, "y": 0}
            food = {"x": 200, "y": 200}
            score = 0
            game_running = True
            
            document["score"].text = "0"
            document["restartBtn"].style.display = "none" # Hide button
            draw()

        def draw_rect(color, x, y):
            ctx.fillStyle = color
            ctx.fillRect(x, y, SIZE - 2, SIZE - 2)

        def move_snake():
            global food, score, game_running
            if not game_running: return

            head = {"x": snake[0]["x"] + direction["x"], "y": snake[0]["y"] + direction["y"]}

            # Wall or Self Collision
            if (head["x"] < 0 or head["x"] >= WIDTH or head["y"] < 0 or head["y"] >= WIDTH 
                or head in snake):
                game_over()
                return

            snake.insert(0, head)

            if head["x"] == food["x"] and head["y"] == food["y"]:
                score += 10
                document["score"].text = str(score)
                food = {"x": random.randint(0, 19) * SIZE, "y": random.randint(0, 19) * SIZE}
            else:
                snake.pop()
            draw()

        def draw():
            ctx.clearRect(0, 0, WIDTH, WIDTH)
            draw_rect("#e74c3c", food["x"], food["y"]) # Food
            for segment in snake:
                draw_rect("#2ecc71", segment["x"], segment["y"]) # Snake

        def change_direction(ev):
            global direction
            key = ev.keyCode
            if key == 37 and direction["x"] == 0: direction = {"x": -SIZE, "y": 0}
            elif key == 38 and direction["y"] == 0: direction = {"x": 0, "y": -SIZE}
            elif key == 39 and direction["x"] == 0: direction = {"x": SIZE, "y": 0}
            elif key == 40 and direction["y"] == 0: direction = {"x": 0, "y": SIZE}

        def game_over():
            global game_running
            game_running = False
            document["restartBtn"].style.display = "block" # Show restart button
            ctx.fillStyle = "white"
            ctx.font = "30px Arial"
            ctx.fillText("GAME OVER", 110, 200)

        # Connect the button to the init_game function
        document["restartBtn"].bind("click", init_game)
        document.bind("keydown", change_direction)
        
        # Start the first game
        init_game()
        timer.set_interval(move_snake, 150)
    </script>
</body>
</html>